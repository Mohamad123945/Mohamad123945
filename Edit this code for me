// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/ // Â© Bing //@version=4 strategy("Blackflag FTS Bot", overlay = true, resolution = "", initial_capital = 10000, default_qty_type = strategy.percent_of_equity, default_qty_value = 100, commission_type = strategy.commission.percent, commission_value = 0.1) // inputs // //{ trailType = input("modified", "Trailtype", options = ["modified", "unmodified"]) ATRPeriod = input(28, "ATR Period") ATRFactor = input(5, "ATR Factor") show_fib_entries = input(true, "Show Fib Entries?") stop_loss = input(5, "Stop Loss (%)") //} //////// FUNCTIONS ////////////// //{ // Wilders ma // Wild_ma(_src, _malength) => _wild = 0.0 _wild := nz(_wild[1]) + (_src - nz(_wild[1])) / _malength /////////// TRUE RANGE CALCULATIONS ///////////////// HiLo = min(high - low, 1.5 * nz(sma((high - low), ATRPeriod))) HRef = low<= high[1] ? high - close[1] : (high - close[1]) - 0.5 * (low- high[1]) LRef = high >= low[1] ? close[1] - low: (close[1] - low) - 0.5 * (low[1] - high) trueRange = trailType == "modified" ? max(HiLo, HRef, LRef) : max(high - low, abs(high - close[1]), abs(low - close[1])) //} /////////// TRADE LOGIC //////////////////////// //{ loss = ATRFactor * Wild_ma(trueRange, ATRPeriod) Up = close - loss Dn = close + loss TrendUp = Up TrendDown = Dn Trend = 1 TrendUp := close[1] > TrendUp[1] ? max(Up, TrendUp[1]) : Up TrendDown := close[1] < TrendDown[1] ? min(Dn, TrendDown[1]) : Dn Trend := close > TrendDown[1] ? 1 : close < TrendUp[1]? -1 : nz(Trend[1],1) trail = Trend == 1? TrendUp : TrendDown ex = 0.0 ex := crossover(Trend, 0) ? high : crossunder(Trend, 0) ? low : Trend == 1 ? max(ex[1], high) : Trend == -1 ? min(ex[1], low) : ex[1] //} // //////// PLOT TP and SL ///////////// //{ plot(trail, "Trailingstop", style = plot.style_line, color = Trend == 1 ? color.green : Trend == -1 ? color.red : na) plot(ex, "Extremum", style = plot.style_circles, color = Trend == 1? color.lime : Trend == -1? color.fuchsia : na) //} ////// FIBONACCI LEVELS /////////// //{ state = Trend == 1 ? "long" : "short" fib1Level = 61.8 fib2Level = 78.6 fib3Level = 88.6 f1 = ex + (trail - ex) * fib1Level / 100 f2 = ex + (trail - ex) * fib2Level / 100 f3 = ex + (trail - ex) * fib3Level / 100 l100 = trail + 0 Fib1 = plot(f1, "Fib 1", style = plot.style_line, color = color.black) Fib2 = plot(f2, "Fib 2", style = plot.style_line, color = color.black) Fib3 = plot(f3, "Fib 3", style = plot.style_line, color = color.black) L100 = plot(l100, "l100", style = plot.style_line, color = color.black) fill(Fib1, Fib2, color = state == "long"? color.green : state == "short"? color.red : na) fill(Fib2, Fib3, color = state == "long"? color.new(color.green, 70) : state == "short"? color.new(color.red, 70) : na) fill(Fib3, L100, color = state == "long"? color.new(color.green, 60) : state == "short"? color.new(color.red, 60) : na) l1 = state[1] == "long" and crossunder(close, f1[1]) l2 = state[1] == "long" and crossunder(close, f2[1]) l3 = state[1] == "long" and crossunder(close, f3[1]) s1 = state[1] == "short" and crossover(close, f1[1]) s2 = state[1] == "short" and crossover(close, f2[1]) s3 = state[1] == "short" and crossover(close, f3[1]) atr = sma(trueRange, 14) /////////// FIB PLOTS /////////////////. plotshape(show_fib_entries and l1 ? low - atr : na, "LS1", style = shape.triangleup, location = location.belowbar, color = color.yellow, size = size.tiny) plotshape(show_fib_entries and l2 ? low - 1.5 * atr : na, "LS2", style = shape.triangleup, location = location.belowbar, color = color.yellow, size = size.tiny) plotshape(show_fib_entries and l3 ? low - 2 * atr : na, "LS3", style = shape.triangleup, location = location.belowbar, color = color.yellow, size = size.tiny) plotshape(show_fib_entries and s1 ? high + atr : na, "SS1", style = shape.triangledown, location = location.abovebar, color = color.yellow, size = size.tiny) plotshape(show_fib_entries and s2 ? high + 1.5 * atr : na, "SS2", style = shape.triangledown, location = location.abovebar, color = color.yellow, size =size.tiny) plotshape(show_fib_entries and s3 ? high + 2 * atr : na, "SS3", style = shape.triangledown, location = location.abovebar, color = color.yellow, size = size.tiny) //} ///////// STRATEGY ENTRY AND EXIT //////////// //{ longCondition = crossover(Trend, 0) shortCondition = crossunder(Trend, 0) if (longCondition) strategy.close("Short") strategy.entry("Long", strategy.long) if (shortCondition) strategy.close("Long") strategy.entry("Short", strategy.short) strategy.exit("Long", loss = strategy.equity * stop_loss / 100) strategy.exit("Short", loss = strategy.equity * stop_loss / 100) //}
